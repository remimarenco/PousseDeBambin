@model PousseDeBambin.Models.List

@{
    ViewBag.Title = "TestJQWidgets";
}

@section scripts {
    <link rel="stylesheet" href="~/jqwidgets/styles/jqx.base.css" type="text/css" />
    <script type="text/javascript" src="~/jqwidgets/jqxcore.js"></script>
    <script type="text/javascript" src="~/jqwidgets/jqxdata.js"></script>
    <script type="text/javascript" src="~/jqwidgets/jqxbuttons.js"></script>
    <script type="text/javascript" src="~/jqwidgets/jqxscrollbar.js"></script>
    <script type="text/javascript" src="~/jqwidgets/jqxmenu.js"></script>
    <script type="text/javascript" src="~/jqwidgets/jqxlistbox.js"></script>
    <script type="text/javascript" src="~/jqwidgets/jqxdropdownlist.js"></script>
    <script type="text/javascript" src="~/jqwidgets/jqxgrid.js"></script>
    <script type="text/javascript" src="~/jqwidgets/jqxgrid.selection.js"></script>
    <script type="text/javascript" src="~/jqwidgets/jqxgrid.columnsresize.js"></script>
    <script type="text/javascript" src="~/jqwidgets/jqxgrid.filter.js"></script>
    <script type="text/javascript" src="~/jqwidgets/jqxgrid.sort.js"></script>
    <script type="text/javascript" src="~/jqwidgets/jqxgrid.pager.js"></script>
    <script type="text/javascript" src="~/jqwidgets/jqxgrid.grouping.js"></script>
    <script type="text/javascript" src="~/jqwidgets/jqxgrid.edit.js"></script>
}

<script type="text/javascript">
    $(document).ready(function () {
        // prepare the data
        var source =
            {
                datatype: "json",
                datafields: [
                     { name: 'ListID', type: 'number' },
                     { name: 'GiftId', type: 'number' },
					 { name: 'Objet', type: 'string' },
                     { name: 'Name', type: 'string' },
					 { name: 'Description', type: 'string' },
					 { name: 'Price', type: 'number' },
					 { name: 'ImageUrl', type: 'string' },
					 { name: 'WebSite', type: 'string' }
                ],
                url: "@Url.Action("GetGifts", "List")",
                data: { id: "@Model.ListId" },
                updaterow: function (rowid, rowdata, commit) {
                    // synchronize with the server - send update command
                    $.ajax({
                        dataType: 'json',
                        url: '@Url.Action("UpdateGift", "Gift")',
                        data: rowdata,
                        cache: false,
                        type: "POST",
                        success: function (data, status, xhr) {
                            // update command is executed.
                            commit(true);
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            alert(errorThrown);
                            // cancel the update.
                            commit(false);
                        }
                    });
                }
            };
        var dataAdapter = new $.jqx.dataAdapter(source, {
            loadComplete: function (data) {
                // data is loaded.
                // On charge les images
                loadLocalizationFr();
            }
        });

        // On ajoute les images
        var cellsrendererImage = function (row, columnfield, value, defaulthtml, columnproperties) {
            return '<div><img src="'+value+'"/></div>';
        };

        var cellsrendererObjet = function (row, columnfield, value, defaulthtml, columnproperties) {
            //return '<div id="divObjectName">'</div>';
        };

        function loadLocalizationFr() {
            var localizationobj = {};
            localizationobj.pagergotopagestring = "Aller à la page:";
            localizationobj.pagershowrowsstring = "Montrer les lignes:";
            localizationobj.pagerrangestring = " de ";
            localizationobj.pagernextbuttonstring = "suivant";
            localizationobj.pagerpreviousbuttonstring = "precedent";
            localizationobj.sortascendingstring = "Ordre croissant";
            localizationobj.sortdescendingstring = "Ordre descendant";
            localizationobj.sortremovestring = "Supprimer ordre";
            localizationobj.firstDay = 1;
            localizationobj.percentsymbol = "%";
            localizationobj.currencysymbol = "€";
            localizationobj.currencysymbolposition = "after";
            localizationobj.decimalseparator = ",";
            localizationobj.thousandsseparator = "";
            var days = {
                // full day names
                names: ["Dimanche", "Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi"],
                // abbreviated day names
                namesAbbr: ["Dim", "Lun", "Mar", "Mer", "Jeu", "Ven", "Sam"],
                // shortest day names
                namesShort: ["Di", "Lu", "Ma", "Me", "Je", "Ve", "Sa"]
            };
            localizationobj.days = days;
            var months = {
                // full month names (13 months for lunar calendards -- 13th month should be "" if not lunar)
                names: ["Janvier", "Fevrier", "Mars", "Avril", "Mai", "Juin", "Julliet", "Aout", "Septembre", "Octobre", "Novembre", "Decembre", ""],
                // abbreviated month names
                namesAbbr: ["Jan", "Fev", "Mar", "Avr", "Mai", "Jui", "Jul", "Aou", "Sep", "Oct", "Nov", "Dec", ""]
            };
            localizationobj.months = months;
            // apply localization.
            $("#grid").jqxGrid('localizestrings', localizationobj);
        }

        // initialize jqxGrid
        $("#grid").jqxGrid(
            {
                columnsresize: true,
                source: dataAdapter,
                editable: true,
                columns: [
                    { text: "Id de la liste", datafield: "ListID" },
                    { text: "Id du cadeau", datafield: "GiftId" },
                    { text: "Image", datafield: "ImageUrl", cellsrenderer: cellsrendererImage },
                    { text: "Site internet", datafield: "WebSite" },
                    { text: "Nom", datafield: "Name" },
                    { text: "Description", datafield: "Description" },
                    { text: "Prix", datafield: "Price" }
                ]
            });
    });
</script>

<h2>TestJQWidgets</h2>

<div id="grid">

</div>
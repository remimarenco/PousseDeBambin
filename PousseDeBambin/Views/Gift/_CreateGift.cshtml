@model PousseDeBambin.Models.Gift

@Html.ValidationSummary(true)
@Html.AntiForgeryToken()
<fieldset>
    <legend>Nouveau cadeau</legend>

    @Html.HiddenFor(model => model.ListID)

    <div class="editor-label">
        @Html.LabelFor(model => model.WebSite)
    </div>
    <div class="editor-field">
        @Html.EditorFor(model => model.WebSite)
        <a href="#" id="btnCreateSearchObject" class="btn btn-primary btn-sm" role="button">
            <img id="createAjaxLoading" class="ajaxLoadingGift" src="~/Content/themes/base/images/loading/ajax-loader.gif" alt="Loading" />
            Chercher automatiquement les informations de l'objet
        </a>
        @Html.ValidationMessageFor(model => model.WebSite)
    </div>

    <div class="editor-label">
        @Html.LabelFor(model => model.ImageUrl)
    </div>
    <div class="editor-field">
        @Html.EditorFor(model => model.ImageUrl)
        @Html.ValidationMessageFor(model => model.ImageUrl)
    </div>

    <div class="editor-label">
        @Html.LabelFor(model => model.Price)
    </div>
    <div class="editor-field">
        @Html.EditorFor(model => model.Price)
        @Html.ValidationMessageFor(model => model.Price)
    </div>

    <div class="editor-label">
        @Html.LabelFor(model => model.Name)
    </div>
    <div class="editor-field">
        @Html.EditorFor(model => model.Name)
        @Html.ValidationMessageFor(model => model.Name)
    </div>

    <div class="editor-label">
        @Html.LabelFor(model => model.Description)
    </div>
    <div class="editor-field">
        @Html.EditorFor(model => model.Description)
        @Html.ValidationMessageFor(model => model.Description)
    </div>
    <div class="spaceTop">
        <input type="submit" class="btn btn-success" value="J'ajoute mon cadeau !" />
    </div>
</fieldset>


<script>
    $(function () {
        $('#createAjaxLoading').hide();
        $("#btnCreateSearchObject").click(function () {
            // We get the website
            var website = $('#createPart #WebSite').val();

            // Loading
            $('#createAjaxLoading').show();

            $.ajax({
                url: 'http://api.diffbot.com/v2/product',
                crossDomain: true,
                data: { 'token': '2d5a54f7471c7958ae0c4d3dcdcd5592', 'url': website },
                dataType: 'json',
                type: 'GET',
                success: function (data) {
                    // Fill all divs with the return of the data

                    // ImageUrl
                    $("#createPart #ImageUrl").val(data.products[0].media[0].link);
                    // Price
                    $("#createPart #Price").val(data.products[0].offerPriceDetails.amount);
                    // Title / Name of the product
                    $("#createPart #Name").val(data.products[0].title);
                    // Description
                    $("#createPart #Description").val(data.products[0].description);

                    $('#createAjaxLoading').hide();
                },
                error: function (jqXHR, textStatus, errorThrown)
                {
                    alert("Un problème est en cours avec la recherche automatique, veuillez réessayer plus tard :). En attendant, vous pouvez toujours entrer les informations à la main ;).");
                    $('#createAjaxLoading').hide();
                }
            });

            return false;
        });
    });
</script>